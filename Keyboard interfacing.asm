ROW_0 DB 0, 1, 2, 3
ROW_1 DB 4, 5, 6, 7
ROW_2 DB 8, 9, 0AH, 0BH
ROW_3 DB 0CH, 0DH, 0EH, 0FH
KEY DB 0
CR EQU 0C6H
PA EQU 0C0H
PB EQU 0C2H
MOV AL, 82H
OUT CR, AL

MOV AL, 0 ;Column reading
OUT PA, AL
KEYP: IN AL, PB
AND AL, 0FH
CMP AL, 0FH
JZ KEYP
CALL DELAY
IN AL, PB
AND AL, 0FH
CMP AL, 0FH
JZ KEYP

ROW0: MOV AL, 0FEH ;Row 0 reading
OUT PA, AL
IN AL, PB
AND AL, 0FH
CMP AL, 0FH
JZ ROW1
LEA SI, ROW_0
JMP COL_ID

ROW1: MOV AL, 0FDH ;Row 1 reading
OUT PA, AL
IN AL, PB
AND AL, 0FH
CMP AL, 0FH
JZ ROW2
LEA SI, ROW_1
JMP COL_ID   

ROW2: MOV AL, 0FBH ;Row 2 reading
OUT PA, AL
IN AL, PB
AND AL, 0FH
CMP AL, 0FH
JZ ROW3
LEA SI, ROW_2
JMP COL_ID

ROW3: MOV AL, 0F7H ;Row 3 reading
OUT PA, AL
IN AL, PB
AND AL, 0FH
CMP AL, 0FH
JZ KEYP
LEA SI, ROW_3

COL_ID: SHR AL,1 ;Keypress identification
JNC FOUND
INC SI
JMP COL_ID
FOUND:
MOV AL,[SI]
MOV KEY, AL
DELAY PROC NEAR
MOV CX, 6000
AGN: LOOP AGN
RET
DELAY ENDP
END



